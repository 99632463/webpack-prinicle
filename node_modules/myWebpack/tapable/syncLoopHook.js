class SyncLoopHook {
  constructor(args) {
    this.tasks = [];
    this.args = args;
  }

  tap(name, fn) {
    this.tasks.push(fn);
  }

  call(...args) {
    if (args.length < this.args.length) {
      throw new Error('发布个数少了');
    }

    args = args.slice(0, this.args.length);

    for (let i = 0; i < this.tasks.length; i++) {
      const task = this.tasks[i];
      let result;
      
      do {
        result = task(...args);
      } while (result !== undefined);
    }
  }
}